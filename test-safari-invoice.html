<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Safari Invoice Print</title>
    <style>
        /* Test styles similar to the invoice */
        .test-invoice {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            border: 2px solid #d4b896;
            border-radius: 12px;
            background: white;
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #d4b896;
        }
        
        .test-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .test-table th,
        .test-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #d4b896;
        }
        
        .test-totals {
            display: flex;
            justify-content: flex-end;
        }
        
        .test-totals-content {
            width: 300px;
        }
        
        .test-total-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }
        
        .test-highlight {
            background-color: rgba(212, 184, 150, 0.1);
            color: #d4b896;
            font-weight: bold;
        }
        
        /* Print styles - more targeted */
        @media print {
            @page {
                margin: 0.5in;
                size: A4;
            }
            
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* Hide ONLY sidebars, preserve main content */
            .fake-sidebar,
            .fake-right-sidebar {
                display: none !important;
                visibility: hidden !important;
            }
            
            /* Ensure main content is visible */
            .test-invoice {
                border: none !important;
                border-radius: 0 !important;
                box-shadow: none !important;
                margin: 0 !important;
                max-width: 100% !important;
                width: 100% !important;
                display: block !important;
                visibility: visible !important;
            }
            
            /* Ensure all invoice content is visible */
            .test-invoice * {
                display: revert !important;
                visibility: visible !important;
            }
            
            body {
                margin: 0 !important;
                padding: 20px !important;
            }
            
            .test-header {
                display: table !important;
                width: 100% !important;
            }
            
            .test-header > * {
                display: table-cell !important;
                vertical-align: top !important;
            }
            
            .test-header > *:last-child {
                text-align: right !important;
            }
            
            .test-table {
                display: table !important;
                width: 100% !important;
            }
            
            .test-table th,
            .test-table td {
                display: table-cell !important;
            }
            
            .test-totals {
                display: block !important;
            }
            
            .test-total-row {
                display: table !important;
                width: 100% !important;
            }
            
            .test-total-row > * {
                display: table-cell !important;
            }
            
            .test-total-row > *:last-child {
                text-align: right !important;
            }
        }
    </style>
</head>
<body>
    <div class="test-invoice">
        <div class="test-header">
            <div>
                <h1>FAKTUR TEST</h1>
                <p>#INV-TEST-001</p>
            </div>
            <div>
                <h2>RORO MUA</h2>
                <p>Perumahan Kaliwulu blok AC no.1</p>
                <p>Kec.Plered Kab Cirebon</p>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <h3>Diterbitkan Kepada:</h3>
            <p><strong>Ahmad Rizki & Siti Nurhaliza</strong></p>
            <p>Jl. Test Address No. 123</p>
            <p>08123456789</p>
        </div>
        
        <table class="test-table">
            <thead>
                <tr>
                    <th>Layanan</th>
                    <th>QTY</th>
                    <th>Harga</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Paket Wedding Complete</td>
                    <td>1</td>
                    <td>Rp 2.500.000</td>
                    <td>Rp 2.500.000</td>
                </tr>
                <tr>
                    <td>Makeup Akad</td>
                    <td>1</td>
                    <td>Rp 1.500.000</td>
                    <td>Rp 1.500.000</td>
                </tr>
            </tbody>
        </table>
        
        <div class="test-totals">
            <div class="test-totals-content">
                <div class="test-total-row">
                    <span>Subtotal</span>
                    <span>Rp 4.000.000</span>
                </div>
                <div class="test-total-row">
                    <span>DP1</span>
                    <span>Rp 2.000.000</span>
                </div>
                <div class="test-total-row test-highlight">
                    <span>Sisa Tagihan</span>
                    <span>Rp 2.000.000</span>
                </div>
            </div>
        </div>
    </div>
    
    <div style="text-align: center; margin: 20px;">
        <button onclick="testPrint()" style="padding: 10px 20px; background: #d4b896; border: none; border-radius: 5px; cursor: pointer;">
            Test Print (Safari Compatible)
        </button>
    </div>
    
    <script>
        function testPrint() {
            const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
            const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
            
            if (isSafari) {
                console.log('Safari detected - applying fixes');
                
                // Set filename
                const originalTitle = document.title;
                document.title = 'Invoice_AhmadRizki_SitiNurhaliza_TEST-001';
                
                // Apply Safari fixes
                document.body.style.transform = 'none';
                document.body.style.webkitTransform = 'none';
                document.body.style.overflow = 'visible';
                
                setTimeout(() => {
                    window.print();
                    document.title = originalTitle;
                }, 100);
            } else if (isChrome) {
                console.log('Chrome detected - applying comprehensive Chrome fixes');
                
                // Set filename
                const originalTitle = document.title;
                document.title = 'Invoice_AhmadRizki_SitiNurhaliza_TEST-001';
                
                // Add comprehensive Chrome print styles
                const chromeStyle = document.createElement('style');
                chromeStyle.id = 'chrome-print-temp';
                chromeStyle.textContent = `
                    @media print {
                        @page {
                            margin: 0.5in;
                            size: A4;
                        }
                        
                        /* Hide ALL possible navigation and sidebar elements */
                        aside, nav, header, footer,
                        .sidebar, .navigation, .nav, .menu,
                        .fake-sidebar, .fake-right-sidebar,
                        [class*="sidebar"], [class*="nav"], [class*="menu"], [class*="header"],
                        [class*="fixed"], .fixed,
                        [class*="w-64"], [class*="w-60"], [class*="w-56"], [class*="w-52"], [class*="w-48"],
                        [id*="menu"], [id*="nav"], [id*="sidebar"], [id*="header"],
                        [role="navigation"], [role="banner"], [role="complementary"] {
                            display: none !important;
                            visibility: hidden !important;
                            opacity: 0 !important;
                            position: absolute !important;
                            left: -9999px !important;
                        }
                        
                        /* Ensure body and html are clean */
                        html, body {
                            margin: 0 !important;
                            padding: 20px !important;
                            background: white !important;
                            color: black !important;
                            overflow: visible !important;
                        }
                        
                        /* Ensure main content is visible */
                        .test-invoice {
                            display: block !important;
                            visibility: visible !important;
                            opacity: 1 !important;
                            position: static !important;
                            width: 100% !important;
                            max-width: 100% !important;
                            margin: 0 !important;
                            padding: 20px !important;
                            background: white !important;
                            color: black !important;
                            box-shadow: none !important;
                            border: none !important;
                            border-radius: 0 !important;
                        }
                        
                        /* Ensure all invoice content is visible */
                        .test-invoice,
                        .test-invoice *,
                        .test-invoice h1,
                        .test-invoice h2,
                        .test-invoice h3,
                        .test-invoice p,
                        .test-invoice div,
                        .test-invoice span,
                        .test-invoice table,
                        .test-invoice th,
                        .test-invoice td,
                        .test-invoice tr {
                            display: revert !important;
                            visibility: visible !important;
                            opacity: 1 !important;
                            color: inherit !important;
                        }
                        
                        /* Table specific fixes */
                        .test-table {
                            display: table !important;
                            width: 100% !important;
                            border-collapse: collapse !important;
                        }
                        
                        .test-table th,
                        .test-table td {
                            display: table-cell !important;
                            padding: 8px !important;
                        }
                        
                        .test-table tr {
                            display: table-row !important;
                        }
                    }
                `;
                document.head.appendChild(chromeStyle);
                
                setTimeout(() => {
                    window.print();
                    document.title = originalTitle;
                    
                    // Remove temp style
                    const tempStyle = document.getElementById('chrome-print-temp');
                    if (tempStyle) tempStyle.remove();
                }, 100);
            } else {
                console.log('Other browser - standard print');
                window.print();
            }
        }
        
        // Log browser info for debugging
        console.log('User Agent:', navigator.userAgent);
        console.log('Is Safari:', /^((?!chrome|android).)*safari/i.test(navigator.userAgent));
        console.log('Is Chrome:', /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor));
    </script>
    
    <!-- Simulate multiple sidebars for testing -->
    <div class="fake-sidebar" style="position: fixed; top: 0; left: 0; width: 200px; height: 100vh; background: #f0f0f0; border-right: 1px solid #ccc; z-index: 1000;">
        <div style="padding: 20px;">
            <h3>Left Sidebar</h3>
            <p>This simulates the left sidebar that should be hidden during print</p>
        </div>
    </div>
    
    <div class="fake-right-sidebar space-y-6" style="position: fixed; top: 0; right: 0; width: 300px; height: 100vh; background: #f9f9f9; border-left: 1px solid #ccc; z-index: 1000; overflow-y: auto;">
        <div style="padding: 20px;">
            <h3>Right Sidebar</h3>
            <div style="background: white; border: 2px solid #d4b896; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h4>Pengaturan Faktur</h4>
                <p>This simulates the settings sidebar</p>
            </div>
            <div style="background: white; border: 2px solid #d4b896; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h4>Riwayat Pembayaran</h4>
                <p>This simulates the payment history</p>
            </div>
            <div style="background: white; border: 2px solid #d4b896; border-radius: 12px; padding: 20px;">
                <h4>Catatan / Keterangan</h4>
                <p>This simulates the notes section</p>
            </div>
        </div>
    </div>
</body>
</html>