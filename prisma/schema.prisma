generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  username  String   @unique @db.VarChar(50)
  email     String   @unique @db.VarChar(100)
  password  String   @db.VarChar(255) // Hashed password
  name      String   @db.VarChar(100)
  role      String   @default("admin") @db.VarChar(20)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
  @@index([username])
  @@index([email])
}

model Client {
  id                String        @id @default(cuid())
  brideName         String        @map("bride_name") @db.VarChar(255)
  groomName         String        @map("groom_name") @db.VarChar(255)
  primaryPhone      String        @map("primary_phone") @db.VarChar(50)
  secondaryPhone    String?       @map("secondary_phone") @db.VarChar(50)
  brideAddress      String        @map("bride_address") @db.Text
  groomAddress      String        @map("groom_address") @db.Text
  brideParents      String        @map("bride_parents") @db.VarChar(255)
  groomParents      String        @map("groom_parents") @db.VarChar(255)
  ceremonyDate      DateTime      @map("ceremony_date") @db.Date
  ceremonyTime      String?       @map("ceremony_time") @db.VarChar(10)
  receptionDate     DateTime      @map("reception_date") @db.Date
  receptionTime     String?       @map("reception_time") @db.VarChar(10)
  eventLocation     String        @map("event_location") @db.Text
  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @updatedAt @map("updated_at")
  
  appointments      Appointment[]
  orders            Order[]

  @@map("clients")
  @@index([brideName, groomName])
}

model Appointment {
  id          String   @id @default(cuid())
  title       String   @db.VarChar(255)
  description String?  @db.Text
  startTime   DateTime @map("start_time")
  endTime     DateTime @map("end_time")
  clientId    String?  @map("client_id")
  client      Client?  @relation(fields: [clientId], references: [id], onDelete: Cascade)
  color       String   @default("#d4b896") @db.VarChar(7)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("appointments")
  @@index([startTime, endTime])
  @@index([clientId])
}

model Order {
  id                String    @id @default(cuid())
  orderNumber       String    @unique @default("") @map("order_number") @db.VarChar(50)
  orderSequence     Int       @unique @map("order_sequence")
  clientId          String    @map("client_id")
  client            Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  eventLocation     String    @map("event_location") @db.Text
  
  items             Json      @db.Json
  
  stageModelPhoto   String?   @map("stage_model_photo") @db.LongText
  chairModel        String?   @map("chair_model") @db.VarChar(255)
  tentColorPhoto    String?   @map("tent_color_photo") @db.LongText
  softlensColor     String?   @map("softlens_color") @db.VarChar(255)
  dressPhotos       Json?     @map("dress_photos") @db.Json
  specialRequest    String?   @map("special_request") @db.Text
  
  totalAmount       Decimal   @map("total_amount") @db.Decimal(15, 2)
  paidAmount        Decimal   @default(0) @map("paid_amount") @db.Decimal(15, 2)
  remainingAmount   Decimal   @map("remaining_amount") @db.Decimal(15, 2)
  
  paymentStatus     String    @default("Belum Lunas") @map("payment_status") @db.VarChar(50)
  notes             String?   @db.Text
  
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  
  payments          Payment[]
  invoices          Invoice[]

  @@map("orders")
  @@index([clientId])
  @@index([orderNumber])
}

model Payment {
  id                String    @id @default(cuid())
  orderId           String    @map("order_id")
  order             Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  paymentNumber     Int       @map("payment_number")
  // FIX: Perbesar dari (12,2) ke (15,2)
  amount            Decimal   @db.Decimal(15, 2)
  paymentDate       DateTime  @default(now()) @map("payment_date")
  paymentMethod     String    @default("Transfer Bank") @map("payment_method") @db.VarChar(100)
  notes             String?   @db.Text
  
  createdAt         DateTime  @default(now()) @map("created_at")
  
  invoice           Invoice?

  @@map("payments")
  @@index([orderId])
}

model Invoice {
  id                String    @id @default(cuid())
  invoiceNumber     String    @unique @map("invoice_number") @db.VarChar(50)
  orderId           String    @map("order_id")
  order             Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  paymentId         String?   @unique @map("payment_id")
  payment           Payment?  @relation(fields: [paymentId], references: [id], onDelete: SetNull)
  
  issueDate         DateTime  @default(now()) @map("issue_date")
  dueDate           DateTime? @map("due_date")
  
  amount            Decimal   @db.Decimal(12, 2)
  paidAmount        Decimal   @default(0) @map("paid_amount") @db.Decimal(12, 2)
  status            String    @default("Pending") @db.VarChar(50)
  
  notes             String?   @db.Text
  
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  @@map("invoices")
  @@index([orderId])
  @@index([invoiceNumber])
}

model Product {
  id                String    @id @default(cuid())
  name              String    @db.VarChar(255)
  category          String    @db.VarChar(100)
  description       String?   @db.Text
  price             Decimal   @db.Decimal(12, 2)
  imageUrl          String?   @map("image_url") @db.LongText
  isActive          Boolean   @default(true) @map("is_active")
  
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  @@map("products")
  @@index([category])
  @@index([name])
}